<!DOCTYPE html>
<html lang="cs">
<head>
  <!-- Project: base_kaufland -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Čištění popisů Heureka → BaseLinker</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Čištění produktových popisů (BaseLinker)</h1>
  <p class="sub">Nastavte API, pravidla čištění, vyberte produkty z katalogu a synchronizujte popisy do vybraného kanálu.</p>

  <!-- Krok 1: API Setup -->
  <div class="step card" id="step1">
    <h2><span class="step-badge">1</span>API Setup</h2>
    <label for="blToken">BaseLinker API token (X-BLToken)</label>
    <input type="password" id="blToken" placeholder="Váš token z BaseLinker → Účet → API" autocomplete="off">
    <label for="inventoryId">INVENTORY_ID (ID katalogu)</label>
    <input type="text" id="inventoryId" placeholder="5257" value="5257">
    <label for="fieldId">Kanál (účet) pro synchronizaci popisů</label>
    <select id="fieldId">
      <option value="description|cs|kauflandcz_0">Kaufland</option>
      <option value="description|cs|sportisimo_0">Sportisimo</option>
      <option value="description|cs|decathlon_0">Decathlon</option>
      <option value="description|cs|alza_0">Alza</option>
    </select>
    <button type="button" class="btn" id="btnVerifyConnection">Ověřit spojení</button>
    <div id="msg1" class="msg hidden"></div>

    <h3 style="margin-top:1.25rem;">Načíst produkt podle ID</h3>
    <p class="sub">Zadejte Product ID z katalogu – zobrazí se data produktu z BaseLinker API.</p>
    <label for="testProductId">Product ID</label>
    <input type="text" id="testProductId" placeholder="např. 2685">
    <button type="button" class="btn" id="btnGetProductInfo">Načíst informace o produktu</button>
    <div id="productInfoWrap" class="hidden" style="margin-top:0.75rem;">
      <strong>Odpověď API:</strong>
      <pre id="productInfoOutput" class="preview-html" style="max-height:320px; margin-top:0.25rem; font-size:0.8rem;"></pre>
      <button type="button" class="btn hidden" id="btnEditProduct" style="margin-top:0.75rem;">Upravit podle pravidel čištění</button>
    </div>
    <div id="productEditTableWrap" class="hidden" style="margin-top:1rem;">
      <h4>Tabulka produktu (původní × vyčištěné text_fields)</h4>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Název</th>
            <th>Původní HTML (náhled)</th>
            <th>Nové HTML (náhled)</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="productEditTableBody"></tbody>
      </table>
      <div style="margin-top:0.75rem;">
        <button type="button" class="btn secondary" id="btnCopyOriginalHtml">Kopírovat celé původní HTML</button>
        <button type="button" class="btn secondary" id="btnCopyNewHtml">Kopírovat celé nové HTML</button>
      </div>
      <button type="button" class="btn" id="btnSyncEditedProduct" style="margin-top:0.5rem;">Synchronizovat do vybraného kanálu</button>
      <div id="msgEditSync" class="msg hidden" style="margin-top:0.5rem;"></div>
    </div>

    <h3 style="margin-top:1.5rem;">Načíst seznam produktů z katalogu</h3>
    <p class="sub">Načte základní seznam produktů (ID, název) z BaseLinker. Vyfiltrujte, vyberte jeden nebo více a připravte k čištění popisů.</p>
    <button type="button" class="btn" id="btnLoadCatalogList">Načíst seznam produktů</button>
    <div id="msgCatalog" class="msg hidden"></div>
    <div id="catalogListWrap" class="hidden" style="margin-top:1rem;">
      <h4>Seznam produktů z katalogu</h4>
      <div class="catalog-filters">
        <label for="filterCatalogId">Filtrovat ID</label>
        <input type="text" id="filterCatalogId" placeholder="např. 2685 nebo část ID">
        <label for="filterCatalogName">Filtrovat název</label>
        <input type="text" id="filterCatalogName" placeholder="část názvu produktu">
      </div>
      <table class="catalog-table">
        <thead>
          <tr>
            <th class="col-check"><label class="select-all-wrap"><input type="checkbox" id="checkAllCatalog" title="Vybrat vše na stránce"> Vybrat</label></th>
            <th class="col-id">ID</th>
            <th class="col-name">Název</th>
          </tr>
        </thead>
        <tbody id="catalogListBody"></tbody>
      </table>
      <div class="pagination-wrap">
        <button type="button" class="btn secondary" id="btnCatalogPrev" disabled>Předchozí</button>
        <span id="catalogPageInfo" class="page-info">Stránka 1 z 1</span>
        <button type="button" class="btn secondary" id="btnCatalogNext" disabled>Další</button>
      </div>
      <p class="sub" style="margin-top:0.5rem;">Vyberte produkty a klikněte na „Připravit vybrané k čištění“. Načtou se jejich popisy, vyčistí a půjdou synchronizovat v kroku 3.</p>
      <button type="button" class="btn" id="btnPrepareSelected" style="margin-top:0.5rem;">Připravit vybrané k čištění</button>
      <div id="msgPrepare" class="msg hidden" style="margin-top:0.5rem;"></div>
    </div>
  </div>

  <!-- Krok 2: Cleaning Rules -->
  <div class="step card hidden" id="step2">
    <h2><span class="step-badge">2</span>Pravidla čištění</h2>
    <label for="allowedTags">Allowed Tags (oddělené čárkou)</label>
    <input type="text" id="allowedTags" value="p,br,b,strong,i,em,u,h3,h4,h5,ul,ol,li,span">
    <label for="orphanPhrases">Orphan Phrases – „sirotci“ (oddělené čárkou)</label>
    <input type="text" id="orphanPhrases" value="tabulka velikostí,orientační tabulka,velikostní tabulka,slouží pouze pro orientaci">
    <p class="sub" style="margin-top:-0.5rem;">Odstraní se bloky s těmito frázemi vedle obrázku/tabulky i <strong>blok hned pod</strong> obrázkem/tabulkou (popisek). Porovnání je <strong>bez ohledu na velikost písmen</strong> („Tabulka velikostí“ = „tabulka velikostí“).</p>
    <div class="toggle-wrap">
      <input type="checkbox" id="tableToList" checked>
      <label for="tableToList" style="margin:0">Převést tabulky na seznamy (table/tr/td → ul/li)</label>
    </div>
  </div>

  <!-- Krok 3: Připravené produkty a synchronizace -->
  <div class="step card hidden" id="step3">
    <h2><span class="step-badge">3</span>Synchronizace</h2>
    <div id="productsTableWrap" class="hidden">
      <h3>Tabulka produktů</h3>
      <table>
        <thead>
          <tr>
            <th><label class="select-all-wrap"><input type="checkbox" id="checkAll" title="Vybrat vše"> Vybrat vše</label></th>
            <th>ID</th>
            <th>Název</th>
            <th>Původní HTML (náhled)</th>
            <th>Nové HTML (náhled)</th>
          </tr>
        </thead>
        <tbody id="productsTableBody"></tbody>
      </table>
      <p class="sub" style="margin-top:0.5rem;">Synchronizace aktualizuje pouze popis pro vybraný kanál, ne hlavní popis v katalogu.</p>
      <div style="margin-top:0.75rem;">
        <button type="button" class="btn" id="btnSyncSelected">Synchronizovat vybrané</button>
      </div>
      <div class="card" style="margin-top:1rem;">
        <label for="singleProductId">Synchronizovat pouze jedno Product ID (pro testování)</label>
        <input type="text" id="singleProductId" placeholder="např. 12345">
        <button type="button" class="btn" id="btnSyncSingle">Synchronizovat pouze toto ID</button>
      </div>
      <div id="msgSync" class="msg hidden"></div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
